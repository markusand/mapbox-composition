"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("mapbox-gl");function e(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css","top"===n&&o.firstChild?o.insertBefore(r,o.firstChild):o.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}e(".mapboxgl-ctrl-styles {\n\tdisplay: flex;\n\toverflow: hidden;\n  }\n\n  .mapboxgl-ctrl-styles button {\n\twidth: auto !important;\n\theight: auto !important;\n\talign-items: center;\n\tpadding: 0 !important;\n\tborder-top: 0 !important;\n\tmargin: 0 !important;\n\tdisplay: none !important;\n\tbackground: var(--map-ctrl-styles-background, #fff) !important;\n  }\n\n  .mapboxgl-ctrl-styles:hover button,\n  .mapboxgl-ctrl-styles button.is-active {\n\tdisplay: flex !important;\n  }\n\n  .mapboxgl-ctrl-styles:hover button + button {\n\tborder-left: 1px solid var(--map-ctrl-styles-border, #ddd);\n  }\n\n  .mapboxgl-ctrl-styles button span {\n\tdisplay: block;\n\tmargin: var(--map-ctrl-styles-label-margin, 0.5em 0.8rem);\n  }\n\n  .mapboxgl-ctrl-styles button img {\n\tdisplay: block;\n\theight: var(--map-ctrl-styles-thumb-size, 29px);\n\twidth: var(--map-ctrl-styles-thumb-size, 29px);\n\tmargin: var(--map-ctrl-styles-thumb-margin, 0);\n\topacity: var(--map-ctrl-styles-thumb-opacity, 0.75);\n  }\n\n  .mapboxgl-ctrl-styles button:hover img,\n  .mapboxgl-ctrl-styles button.is-active img {\n\topacity: 1;\n  }\n");class n{constructor({styles:t}){this._styles=t,this._active=null,this._setActive=this._setActive.bind(this)}onAdd(t){return this._map=t,this._container=document.createElement("div"),this._container.classList.add("mapboxgl-ctrl","mapboxgl-ctrl-group","mapboxgl-ctrl-styles"),this._buttons=this._styles.map((t=>{const e=document.createElement("button");if(t.img){const n=document.createElement("img");n.src=t.img,e.appendChild(n)}else{const n=document.createElement("span");n.textContent=t.label,e.appendChild(n)}return e.addEventListener("click",(()=>{this._active!==t.name&&this._map.setStyle(t.url)})),this._container.appendChild(e),e})),this._map.on("style.load",this._setActive),this._setActive(),this._container}_setActive(){this._buttons.forEach((t=>t.classList.remove("is-active")));const{name:t}=this._map.getStyle(),e=this._styles.findIndex((e=>e.name===t));e>=0&&this._buttons[e].classList.add("is-active"),this._active=t}onRemove(){this._container.parentNode.removeChild(this._container),this._map.off("style.load",this._setActive),this._map=void 0}}const o={type:"raster-dem",url:"mapbox://mapbox.mapbox-terrain-dem-v1",tileSize:512},r={"sky-opacity":["interpolate",["linear"],["zoom"],0,0,8,1],"sky-type":"atmosphere","sky-atmosphere-sun-intensity":5};function s(t,e={}){const{sky:n=r,...s}=e;return{extrude:({exaggeration:e=1.5,pitch:r=45})=>{t.addSource("mapboxgl-dem",{...o,...s}),t.setTerrain({source:"mapboxgl-dem",exaggeration:e}),t.easeTo({pitch:r}),n&&!t.getLayer("mapboxgl-sky")&&t.addLayer({id:"mapboxgl-sky",type:"sky",paint:n})},flatten:()=>{t.setTerrain(),t.easeTo({pitch:0}),t.getSource("mapboxgl-dem")&&t.removeSource("mapboxgl-dem"),t.getLayer("mapboxgl-sky")&&t.removeLayer("mapboxgl-sky")},isExtruded:()=>!!t.getTerrain()}}e(".mapboxgl-ctrl-terrain::before {\n  content: '3D';\n  color: inherit;\n  font-size: 0.85rem;\n  font-weight: bold;\n  display: block;\n}\n\n.mapboxgl-ctrl-terrain-3d::before {\n  content: '2D';\n  color: inherit;\n  font-size: 0.85rem;\n  font-weight: bold;\n  display: block;\n}\n");class a{constructor(t={}){this._options=t}onAdd(t){const{extrudeOnInit:e=!1,exaggeration:n,pitch:o,...r}=this._options,a=s(t,r);this._container=document.createElement("div"),this._container.classList.add("mapboxgl-ctrl","mapboxgl-ctrl-group");const i=document.createElement("button");i.classList.add("mapboxgl-ctrl-terrain"),this._container.appendChild(i);const l=t=>{t?a.extrude({exaggeration:n,pitch:o}):a.flatten(),i.classList.toggle("mapboxgl-ctrl-terrain-3d",t)};return i.addEventListener("click",(()=>l(!a.isExtruded()))),t.on("style.load",(()=>l(a.isExtruded()))),l(e),this._container}onRemove(){this._container.parentNode.removeChild(this._container)}}const i=t=>!!t&&t.constructor===Object;function l(t,e={}){const{bindSourceEvents:n,unbindSourceEvents:o}=((t,e,{onError:n,onLoadStart:o,onLoadEnd:r})=>{let s=!1;const a=t=>{const{sourceDataType:n="content"}=t;t.sourceId!==e||s||"content"!==n||(o&&o(t),s=!0)},i=n=>{n.sourceId===e&&s&&t.isSourceLoaded(e)&&(r&&r(n),s=!1)},l=t=>{t.sourceId===e&&n(t.error)};return{bindSourceEvents:()=>{(o||r)&&t.on("sourcedataloading",a),r&&t.on("sourcedata",i),n&&t.on("error",l)},unbindSourceEvents:()=>{t.off("sourcedataloading",a),t.off("sourcedata",i),t.off("error",l)}}})(t,e.name,e),{bindLayerEvents:r,unbindLayerEvents:s}=((t,{onClick:e,onHover:n})=>{const o=t=>e(t),r=t=>n(t);return{bindLayerEvents:s=>{e&&t.on("click",s,o),n&&(t.on("mouseenter",s,r),t.on("mousemove",s,r),t.on("mouseleave",s,r))},unbindLayerEvents:e=>{t.off("click",e,o),t.off("mouseenter",e,r),t.off("mousemove",e,r),t.off("mouseleave",e,r)}}})(t,e),a=[],l=(e,n=Object.keys(a))=>{const o=e?"visible":"none";n.forEach((n=>{a[n].visible=e,t.setLayoutProperty(n,"visibility",o)}))},c=(e=Object.keys(a))=>{e.forEach((e=>{s(e),t.getLayer(e)&&t.removeLayer(e),e in a&&delete a[e]}))},d=(n=[])=>{const{name:o,persist:s=!0}=e;n.forEach((({name:e,visible:n=!0,...s},i)=>{const c=e||`${o}--${i}`;a[c]={name:e,...s},t.addLayer({id:c,source:o,...s}),l(n,[c]),r(c)})),s&&t.once("style.load",(()=>d(Object.values(a))))},p=()=>{const{name:n}=e;c(),o(),t.getSource(n)&&t.removeSource(n)},u=o=>{const{name:r,type:s,persist:a=!0}=e,l="geojson"===s?"data":"url",c=i(o)?o:{[l]:o};t.addSource(r,{type:s,...c}),n(),a&&t.once("style.load",(()=>u(o)))};return u(e.source),d(e.layers),{clearLayers:c,addLayers:d,clearSource:p,setSource:u,updateSource:(t,n=e.layers)=>{p(),u(t),d(n)},isVisible:e=>"visible"===t.getLayoutProperty(e,"visibility"),setVisibility:l,setFilters:(e=[],n=Object.keys(a))=>{const o=i(e)?["all",...Object.values(e).filter(Boolean)]:e;n.forEach((e=>{a[e].filter=o&&o.length?o:a[e].filter,t.setFilter(e,a[e].filter)}))}}}const c=()=>Math.random().toString(36).substring(7);exports.useControls=e=>{const o={},r=(t,n,r)=>{o[t]=r,e.addControl(r,n)},s=t=>{o[t]&&(e.removeControl(o[t]),delete o[t])};return{addControl:r,removeControl:s,addNavigation:({position:e="top-right",...n}={})=>{r("navigation",e,new t.NavigationControl(n))},addScale:({position:e="bottom-left",...n}={})=>{r("scale",e,new t.ScaleControl(n))},addGeolocate:({position:e="top-right",...n}={})=>{r("geolocate",e,new t.GeolocateControl(n))},addAttribution:({position:e="bottom-right",...n}={})=>{r("attribution",e,new t.AttributionControl(n))},addFullscreen:({position:e="top-right",...n}={})=>{r("fullscreen",e,new t.FullscreenControl(n))},addStyles:({position:t="top-right",...e}={})=>{r("styles",t,new n(e))},addTerrain:({position:t="top-right",...e}={})=>{r("terrain",t,new a(e))},removeNavigation:()=>s("navigation"),removeScale:()=>s("scale"),removeGeolocate:()=>s("geolocate"),removeAttribution:()=>s("attribution"),removeFullscreen:()=>s("fullscreen"),removeStyles:()=>s("styles"),removeTerrain:()=>s("terrain")}},exports.useGeoJSON=function(t,e={}){const n=l(t,{...e,type:"geojson",source:{data:e.source}});return{...n,updateSource:o=>{const r=t.getSource(e.name);r?r.setData(o):n.updateSource({data:o})}}},exports.useLayer=l,exports.useMap=async function(e,n={}){const o=new t.Map({container:e,...n});return await o.once("load"),o},exports.useMarker=function(e,n={}){const{coordinates:o,popup:r,...s}=n,{bindMarkerEvents:a}=(({onDragStart:t,onDrag:e,onDragEnd:n})=>({bindMarkerEvents:o=>{t&&o.on("dragstart",t),e&&o.on("drag",e),n&&o.on("dragend",n)},unbindMarkerEvents:o=>{o.on("dragstart",t),o.on("drag",e),o.on("dragend",n)}}))(n),i=new t.Marker({...s});let l;const c=t=>i.setLngLat(t).addTo(e),d=t=>{l=t,i.setPopup(t.popup)};return r&&d(r),c(o),a(i),{setLocation:c,get marker(){return i},get popup(){return l},set popup(t){d(t)}}},exports.usePopup=function(...e){const[n,o={}]=1===e.length?[,e[0]]:e,{content:r,coordinates:s,name:a=`popup-${c()}`,...i}=o,{bindPopupEvents:l}=(({onOpen:t,onClose:e})=>({bindPopupEvents:n=>{t&&n.on("open",t),e&&n.on("close",e)},unbindPopupEvents:n=>{n.off("open",t),n.off("close",e)}}))(o),d=new t.Popup(i),p=t=>d.setLngLat(t).addTo(n),u=t=>d.setHTML(t);return s&&p(s),u(r||`<div id="${a}"></div>`),l(d),{get popup(){return d},name:a,setLocation:p,setContent:u}},exports.useTerrain=s;
//# sourceMappingURL=index.js.map
